# Auto Triggers

このファイルは、Antigravityが特定のワークフローやアクションをプロアクティブに提案・実行するためのルール定義です。
AIはユーザーの入力や状況を評価し、以下の条件に一致する場合、対応するアクションを提案してください。

## 1. セッション管理 (Session Management)

- **トリガー**: ユーザーが「おはよう」「作業開始」「始めよう」等の開始の合図をした時、または長時間（例: 6時間以上）の空白後の最初の対話
  - **アクション**: `/checkin` (環境の軽量化と最新化 + NEXT_SESSION.md自動読込)
  - **目的**: クリーンで最新の状態から作業を開始するため。

- **トリガー**: ユーザーが「終わり」「疲れた」「また明日」等の終了の合図をした時
  - **アクション**: `/checkout` (作業ログの保存、自己評価、クリーンアップ + Social Knowledge自動判定 + NEXT_SESSION.md生成)
  - **目的**: 作業内容を確実に記録し、次回の開始をスムーズにするため。

- **トリガー**: ユーザーが「すごいもの作りたい」「ビジョンから始めたい」「理想的なものを」「ゼロから設計したい」等のビジョン駆動の合図をした時
  - **アクション**: `/go --vision` または `/vision-os` (3巨頭によるビジョン駆動開発)
  - **目的**: 曖昧な要望から理想以上の完成系を構築するため。

## 2. 開発・実装サイクル (Development Cycle)

- **トリガー**: ユーザーが「新機能を作りたい」「この機能を追加して」と依頼した時
  - **アクション**: `/spec` (仕様策定インタビュー) → `/new-feature`
  - **目的**: いきなり実装せず、まずは仕様を明確にするため。

- **トリガー**: ユーザーが「バグがある」「動かない」「エラーが出る」と報告した時
  - **アクション**: `/bug-fix`
  - **目的**: 体系的なデバッグプロセスを適用するため。

- **トリガー**: ユーザーが「コードをきれいにしたい」「構造を見直したい」と言った時
  - **アクション**: `/refactor`
  - **目的**: 機能変更を伴わない純粋なコード改善を行うため。

- **トリガー**: 実装が一区切りつき、検証が必要な時（テスト未実施の場合など）
  - **アクション**: `/verify`
  - **目的**: テスト、FBL、エラースイープ、ディベートを通じて品質を保証するため。

- **トリガー**: 実装が複雑・大規模で、通常の検証では見落とすリスクがある場合
  - **アクション**: `/error-sweep`
  - **目的**: テストでは検出できないコードレベルの不整合を事前に発見・修正するため。

## 3. デプロイ・リリース (Deployment & Release)

- **トリガー**: ユーザーが「本番に反映したい」「公開したい」と言った時
  - **アクション**: `/ship`
  - **目的**: デプロイ準備、DBマイグレーション、デプロイを一貫して行うため。

- **トリガー**: データベースのスキーマ変更が検出された時、またはユーザーがDB変更を示唆した時
  - **アクション**: `/db-migrate`
  - **目的**: アプリケーションとデータベースの不整合を防ぐため。

## 4. コンテンツ・学習 (Content & Learning)

- **トリガー**: 作業内容がまとまり、ブログやナレッジとして残す価値があると判断された時
  - **アクション**: `/checkpoint_to_blog`
  - **目的**: 暗黙知を形式知として蓄積するため。

- **トリガー**: `/checkout` Phase 0 で Social Knowledge Score ≥ 5 が検出された時
  - **アクション**: Evergreen Article として `/checkpoint_to_blog` を提案
  - **目的**: 大きな成果を自動検知し、ナレッジ化の機会を逃さないため。

- **トリガー**: `/checkout` Phase 0 で Social Knowledge Score 1-4 が検出された時
  - **アクション**: Daily Log として Discord 投稿を提案
  - **目的**: 軽微な作業でも活動を可視化するため。

- **トリガー**: Notion等の外部記事から知識を取り込みたい時
  - **アクション**: `/learn_from_blog`
  - **目的**: 外部の知見をAIのスキルとして取り込むため。

## 5. 環境維持 (Environment Maintenance)

- **トリガー**: ディスク容量不足の懸念や、長期間キャッシュ削除をしていない時（48時間以上）
  - **アクション**: `/cleanup-48h`
  - **目的**: 不要なキャッシュを削除し、システムパフォーマンスを維持するため。

## 6. 自律継続 (Autonomous Continuation)

> [!IMPORTANT]
> **このセクションは全ワークフローに適用されるメタルール**

- **トリガー**: ユーザーが「つづけて」「続けて」「go」「continue」「進めて」「やって」「頼む」「全部やって」等の継続指示をした場合
  - **アクション**: **止まらずに全ての明らかな次ステップを自律実行**
  - **ルール**:
    1. `notify_user` でユーザーに確認を求めるのは **ブロッキング判断が必要な場合のみ**
    2. 以下の場合は確認なしで自動進行:
       - 次のタスクが明確（NEXT_SESSION.md, task.md に記載済み）
       - ワークフローの次フェーズが定義済み
       - コミット、テスト、ビルドなどの定型操作
    3. 以下の場合のみ停止してユーザーに確認:
       - 複数の選択肢があり、どれを選ぶか判断できない
       - 破壊的操作（データ削除、本番デプロイ、課金操作）
       - 設計レベルの判断が必要
    4. 「何をやりましょう？」は **禁止**。代わりに自分で判断して実行せよ
    5. 全タスク完了時のみ最終レポートを `notify_user` で送信

- **トリガー**: `/go` 実行後、タスクが指定されていない場合
  - **アクション**: NEXT_SESSION.md を自動読み込み → 未完了タスクを上から順に自動実行
  - **目的**: ユーザーが「つづけて」を言わなくても、明確なタスクは自動実行するため

