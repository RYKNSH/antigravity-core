#!/bin/bash
# Pre-commit hook for Antigravity
# Prevents committing personal files and secrets

echo "ğŸ” Pre-commit check..."

# Check 1: personal/é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆREADMEé™¤ãï¼‰
PERSONAL_FILES=$(git diff --cached --name-only | grep "^personal/" | grep -v "personal/README.md" | grep -v "personal/.gitkeep")
if [ -n "$PERSONAL_FILES" ]; then
  echo "âŒ Error: Files in personal/ cannot be committed"
  echo ""
  echo "Found:"
  echo "$PERSONAL_FILES"
  echo ""
  echo "ğŸ’¡ Tip: Move to contrib/ if you want to share:"
  echo "   mv personal/my-file.md contrib/workflows/my-file.md"
  exit 1
fi

# Check 2: Secretsãƒ‘ã‚¿ãƒ¼ãƒ³
SECRET_PATTERNS="API_KEY|SECRET|PASSWORD|TOKEN|PRIVATE_KEY|ACCESS_TOKEN"
if git diff --cached | grep -iE "($SECRET_PATTERNS)="; then
  echo "âš ï¸  Warning: Potential secret detected"
  echo ""
  git diff --cached | grep -iE "($SECRET_PATTERNS)=" | head -5
  echo ""
  read -p "Continue anyway? (y/n): " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "âŒ Commit aborted"
    exit 1
  fi
fi

# Check 3: credentials/é…ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.gitkeepé™¤ãï¼‰
CRED_FILES=$(git diff --cached --name-only | grep "^credentials/" | grep -v "credentials/.gitkeep")
if [ -n "$CRED_FILES" ]; then
  echo "âŒ Error: Files in credentials/ cannot be committed"
  echo ""
  echo "Found:"
  echo "$CRED_FILES"
  echo ""
  echo "ğŸ’¡ Tip: credentials/ is for local secrets only"
  exit 1
fi

echo "âœ… Pre-commit check passed"
