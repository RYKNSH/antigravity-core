# Round 2: 複合エラーシナリオ — カスケード障害マップ

**日時**: 2026-02-27T14:16:00+09:00
**前ラウンドからの焦点**: 独立エラーが複合した時のカスケード障害。「何が壊れたらどこまで波及するか」

---

### 🔄 Round 2: 致命的複合シナリオの特定

**⚡ Chaos Engineer**: 独立エラー39個から、致命的な複合パターンを構築する。「ドミノ倒し」の起点と最終到達点を明示する。

#### 🔥 Scenario S1: 「サイレント腐敗」（最も危険）

```
起点: E2.6（MCPサイレント障害）
  → Notion MCPが接続成功するが、トークン権限縮小で一部DB読めない
  → DRG更新時にNotionノードが「空」で上書き
  → E1.3（dangling reference）発生 — 既存エッジの参照先が消える
  → 次セッション: DRGを信頼して「Notionにこの企画書はない」と判断
  → ユーザーに誤情報を提供 → 信頼崩壊
```

**深刻度**: 🔴🔴 超致命的
**検知困難度**: 極めて高い（エラーログに何も出ない）

#### 🔥 Scenario S2: 「全面ロックアウト」

```
起点: macOSアップデート → Keychain APIの仕様変更
  → 全MCP認証が同時に失敗（E2.2 × 5サービス）
  → セッション開始プロトコルのMCPヘルスチェックで全滅（E4.4）
  → DRGの差分更新不可能
  → AI: 古いDRGのみで作業 → 現実との乖離が加速
  → ユーザーが手動でキーを再設定するまで全機能停止
```

**深刻度**: 🔴 致命的
**検知容易度**: 高い（全MCPがエラーを返す）

#### 🔥 Scenario S3: 「部分更新による幽霊データ」

```
起点: E5.5（DRG更新中のクラッシュ）
  → data_graph.json が中途半端な状態で保存
  → ノードAは更新済み、ノードBは旧版のまま
  → 次セッション: ノードAとノードBの間のエッジが矛盾
  → 相関検出（L1）が誤った名前マッチを行い、E6.1（false positive）多発
  → AIが間違った関連付けで行動
```

**深刻度**: 🔴 致命的
**検知困難度**: 中（DRGの整合性チェックで検出可能）

#### 🔥 Scenario S4: 「記憶の毒」

```
起点: E3.2（判断履歴の矛盾）
  → 過去に「歌詞データはGoogle Driveに置く」と判断記録
  → 今回のセッション: 「歌詞データはNotionに移行」と新たに判断
  → memory/decisions.json に矛盾する2つの記録が共存
  → 次セッション: 古い判断を優先して読み込み → Notionに移行済みデータをDriveに戻そうとする
```

**深刻度**: 🟡 中
**検知困難度**: 高い（論理的矛盾はJSONバリデーションで検出不可能）

#### 🔥 Scenario S5: 「同期レース」

```
起点: E5.2（イベント順序逆転）+ E5.3（重複イベント）
  → ファイル作成イベント → ファイルリネームイベント が逆順で到着
  → DRGに「リネーム後の名前」で新規ノード作成 → 直後に「旧名」で別ノード作成
  → 同一ファイルが2つのノードとして存在（重複）
  → さらにWebhookリトライでもう1回繰り返す → 3重ノード
```

**深刻度**: 🟡 中
**検知困難度**: 中（IDベースのdedup処理で防止可能）

#### 🔥 Scenario S6: 「ブートストラップ地獄」

```
起点: P2（初回ブートストラップ）でE2.3（レート制限超過）
  → Notion APIの5req/s制限に4,265ページスキャンが引っかかる
  → 部分的にDRGが構築される（2,000ページ分のみ）
  → ユーザーに「ブートストラップ完了」と報告
  → 残り2,265ページがDRGに存在しない → 「このページは存在しません」と永続的に誤判断
```

**深刻度**: 🔴 致命的
**検知困難度**: 低い（ページ数カウントで検出可能だが、チェックしなければ見逃す）

**🤔 Skeptic**: 6つの複合シナリオが出た。だが全てに共通するパターンがある — **「AIがDRGを信頼しすぎる」** 。DRGはキャッシュ（インデックス）であってSSOTではないと合意したはずだが、**実装レベルでDRGの情報を「事実」として扱ってしまう危険性** がある。これはコードのバグではなく、**設計の哲学的欠陥** だ。

**😈 Devil's Advocate**: さらに言えば、ここに挙がったのは「技術的障害」だけだ。**運用エラー** を忘れている：

| # | 運用エラー | 深刻度 |
|---|----------|--------|
| E7.1 | ユーザーがDRGの存在を忘れて手動でファイル整理 → DRG乖離 | 🟡 中 |
| E7.2 | 新プロジェクト開始時にDRGへの登録を忘れる | 🟡 中 |
| E7.3 | SSD取り外し中にDRG更新が走る → パス解決不能 | 🟡 中 |
| E7.4 | 複数AI（Claude + Gemini等）が同時にDRGを更新 | 🔴 致命 |
| E7.5 | git pushでdata_graph.jsonがマージコンフリクト | 🟡 中 |

**🔒 Security Auditor**: そしてセキュリティシナリオも追加すべきだ：

| # | セキュリティエラー | 深刻度 |
|---|----------|--------|
| E8.1 | decisions.jsonにユーザーの機密判断が平文で記録 → git push | 🔴 致命 |
| E8.2 | DRGにCustomer名が含まれるのにgit管理 → リポ公開時に漏洩 | 🔴 致命 |
| E8.3 | MCP経由でChatworkのDMを読み取り、DRGに要約を記録 → プライバシー侵害 | 🔴 致命 |
| E8.4 | 相関検出L3（AI推論）で「このDiscordの会話はXさんとの不和を示している」等の推論記録 | 🔴 致命 |

---

### 🧭 Moderator Review

| 項目 | 内容 |
|------|------|
| 明確になったこと | 6つの複合シナリオ（S1-S6）、5つの運用エラー（E7.x）、4つのセキュリティエラー（E8.x）を特定。総計48エラー。最も危険なのはS1「サイレント腐敗」とE8.x「機密漏洩」 |
| まだ残る懸念・論点 | 各エラーに対する対処方針（防止/検知/回復）が未策定。特にS1の検知方法 |
| 次ラウンドの焦点 | 全48エラーに対する対処戦略の構造化 |
| **判定** | `Continue` |
| **判定根拠** | エラーを列挙しただけでは価値がない。対処方針まで到達しなければ構造的解決にならない（MR-08） |
