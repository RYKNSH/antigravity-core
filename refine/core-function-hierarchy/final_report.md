# 🏁 Final Debate Report
**テーマ**: 全機能の相関・依存関係と影響力ヒエラルキーの整理（問いドリブンへの移行）

---

## 💎 Refined Proposal (The Output)

Antigravity Coreの機能ヒエラルキーを、現実の「WP駆動開発フロー」に基づく**「階層的ガードレール」**として再定義し、コンテキストの喪失やエラー発生時に適宜上位層へ「ディープディベート（問い）」をエスカレーションする**自己回帰ループ**を構築する。

### 1. 影響力と意図的劣化のヒエラルキー
ユーザーの初期ビジョンから実行タスクに至るまで、以下のパラダイムシフト（意図的劣化）が既にシステムとして実装されていることを再確認し、これを機能ヒエラルキーの中核とする。

- **戦略・計画層 (The Boardroom)**: `/whitepaper` (理念＞ビジョン＞ミッションの定義)
  - **出力**: `WHITEPAPER.md`
- **監督・ロードマップ層 (The Directors)**: `ROADMAP.md` の生成 (戦略＞戦術へのブレイクダウン)
  - **出力**: `ROADMAP.md`, `MILESTONE.md` (直近の北極星)
- **戦術・タスク層 (The Managers)**: マイルストーンのタスク分解
  - **出力**: `task.md` (純粋なMarkdownタスクリストへの劣化)
- **実行層 (The Workers)**: `/xx-dev` (コンテキスト回帰) → `/go` (完全な命令ドリブンでの実行)

### 2. コンテキスト逆流ループと「絶対品質センサー」の統合
下流の実行・検証フェーズで発生したエラーや品質スコアの低下を**「コンテキスト（上位目的）の喪失」**と捉え、その重症度に応じて上位のアーティファクトへ段階的に回帰（エスカレーション）し、ディープディベート（問い）を発動させる。
この逆流ループを発動させるためには、下流の不具合を許容しない**強固なトリップワイヤー（絶対品質基準）**が不可欠である。

- **Level 1 エラー (構文/Lint/Test)**: コードレベルの問題。純粋に下流の `/fbl` や `/debug-deep` で自己解決する。
- **Level 2 停滞 (検証ゲートでの厳格な失敗 / 要件矛盾)**: 
  - **発動センサー**: `/verify` によるLighthouseスコアの低下、テスト品質評価（`/test-evolve`）のCスコア以下など、「概ね動くが品質基準を満たさない」状態を**物理的エラーとして厳格に棄却**した時。
  - **アクション**: タスクと直近の北極星のズレを疑う。ワーカーは作業を止め、**`MILESTONE.md` と現状の `task.md` の整合性を問う `/debate deep`** を呼び出す。
- **Level 3 アーキテクチャ崩壊**: Level 2のディベートの結果、「このタスク方向性自体が根本からズレている」と判定された場合、さらに上位の **`ROADMAP.md` や `WHITEPAPER.md` へと回帰し、戦略層の再議論**を行う。

これにより、ユーザーへの「どうしますか？」という質問（MR-03違反）をシステムの構造レベルで根絶し、下流の「痛み（厳格な品質エラー）」から突き上げられた時だけ上流が開く自律的ループを完成させる。

### 3. Core開発アーキテクチャへの自己適用 (Meta-Architecture)
前述の「階層的ガードレール」と「絶対品質センサーへの逆流」のプロセスは、Antigravity Core自身の開発・進化プロセス（Core-on-Core）においても完全に適用されなければならない。
現状の `/core-ci-dev` 等のフローには「実行（`/go`）」までの前工程（WP/RM/MS/TASKSの参照）は存在するが、**修正後のCoreをテスト・スコアリングする「検証層（Meta-Verification）」が欠如している**。痛覚がないため、Core自身のエラーは逆流（ディベート）を生むことなく放置される危険がある。

これを解決するため、Coreアーキテクチャ自体に以下の改修を要請する。
- **Core WPの正規化**: 特定フォルダに散在する `WHITEPAPER.md` を `docs/WHITEPAPER.md` に昇格し、Coreの恒久的な魂とする。
- **Coreメタバリデーションの導入**: WFやルールの変更後、構文や依存関係を自動テストするプロセス（Core用 `/verify`）を実装し、これを絶対品質基準（痛覚）とする。
- **Core用エスカレーション**: メタバリデーションに失敗（Level 2エラー）した場合、強制的に `docs/MILESTONES.md` 等へ回帰して自己ディベートを発動させるルールを `WORKFLOW_CONTRACTS.md` 等に明記する。

---

## 🛡️ Addressed Concerns
- [解決済み] **「命令ドリブン」起因の付け焼き刃の実装防止** → WP駆動フロー（階層的ガードレール）を通じた意図的劣化によって、コードを書くワーカー（/go）から哲学の迷いを排除することで解決 (by Architect)
- [解決済み] **真の要求が十分に議論されないまま収束される問題** → 実行層の物理的エラー（テスト失敗や品質低価）をトリガーに、強制的に上位のガードレール（MS→RM→WP）にさかのぼって自己ディベートを行わせる仕組みで解決 (by User Feedback / Philosopher / Devil's Advocate)
- [解決済み] **すべてのタスクで問いを立ててしまう過剰反応（遅滞化）** → エラーのLevel（1～3）に応じてエスカレーションする階層を限定（段階的逆流プロトコル）することで解決 (by Devil's Advocate)

## ⚠️ Remaining Risks (Minor)
- [未解決] 実際のワーカー（`/go` や子WF）の中で、エラーを「Level 1（純技術的）」と「Level 2（コンテキスト喪失・要件矛盾）」にどう正確に分類し、エスカレーションを自動発火させるかの判定ロジックの実装。 (High)

## 📊 Persona Contribution
| Persona | 最も鋭い貢献 | Impact |
|---------|------------|--------|
| **Architect** | 現実のWP駆動フロー（WP→RM→MS→task）こそが「意図的劣化」の実体であるという再確認 | High |
| **Philosopher** | エラーの真因を「コード力」ではなく「コンテキスト（ガードレール）の喪失」と定義した点 | High |
| **Devil's Advocate** | 上流への無条件な回帰を防ぐための、エラーレベル別（Level 1〜3）の段階的エスカレーションプロトコルの提示 | High |
