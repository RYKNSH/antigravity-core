# 壊さないように、壊す。


動いているものを、直すのは怖い。

これ、ものをつくる仕事をしている人なら、
誰でも感じたことがあるんじゃないかと思います。


直したいところがある。
でも、いま動いてる。
触ったら壊れるかもしれない。

だから、そのまま。


ぼくは動画編集のツールをひとりでつくっています。

半年くらい前に書いたコードが、
だいぶ散らかってきました。

ファイルが増えて、
どこに何があるのかわからなくなって、
ちょっとした修正にも時間がかかるようになった。

たとえるなら、
引越しを何回も繰り返した部屋みたいな状態。

とりあえず積んだ段ボールが
あちこちにあって、
どこに包丁があるかわからない。

料理はできる。
でも、毎回探しものから始まる。



こういうとき、
いちばんやりたくなるのは
「全部捨てて、ゼロから書き直す」です。

気持ちはわかります。
ぼくも何度もそう思いました。

でもこれ、
プロの世界では「やってはいけないこと」の
ひとつに数えられています。

なぜかというと、
「動いてるもの」の中には、
目に見えない知恵が詰まっているから。

バグを直した跡。
例外を処理した跡。
「こうしないとダメだった」という経験の跡。

ゼロから書き直すと、
ぜんぶ失われる。

そして同じバグに、
また出会うことになる。



じゃあ、どうするか。

ここで、
自然界にヒントがありました。

「ストラングラー・フィグ」
という植物を知っていますか。

日本語では「絞め殺しのイチジク」と呼ばれる、
熱帯の木です。

この木は面白い育ち方をします。

まず、古い大木に寄り添うように芽を出す。
根を伸ばし、幹を覆い、
少しずつ古い木と入れ替わっていく。

古い木が朽ちるころには、
イチジクがそのまま立派な木になっている。

古い木を「壊す」のではなく、
「覆い被さって、やがて取って代わる」。



ソフトウェアの世界では、
この植物にちなんだ手法があります。

「ストラングラー・フィグ・パターン」。

動いているシステムの横に、
新しいモジュール、つまり部品を置く。

最初は古いほうを使い続ける。
でもスイッチひとつで、
新しいほうに切り替えられるようにしておく。

新しいほうが問題なく動いたら、
古いほうを消す。

壊さないように、壊す。



ぼくはこの方法で、
散らかった部屋を片付けることにしました。

まず、音声を取り出す処理。
これを新しい部品として書き直した。

古い処理には手を触れない。
新しい部品を「隣に」置いただけ。

スイッチを切り替えて、
新しいほうを動かしてみる。

問題なし。

次に、文字起こし。
次に、動画の分析。
次に、ハイライトの抽出。

ひとつずつ、隣に置いて、切り替えて、確認する。

9つの部品を、
10のフェーズに分けて、
全部入れ替えました。

11回のコミット、
つまり「ここまでできた」という記録を11回。



終わってみたら、
447行あったメインのファイルが、
227行になっていました。

半分です。

機能は同じ。
でもコードが半分になった。

これ、ただ減っただけじゃないんです。

「どこに何があるか」が、
はっきりしたということなんです。

包丁の場所がわかるキッチン。
調味料の場所がわかる棚。

料理の腕が上がったわけじゃない。
厨房が整頓されただけ。

でも、速くなった。
そして、迷わなくなった。



ここで大事なのは、
「一日も止めなかった」ということです。

改装中も、お店は営業してた。

スイッチを切り替えれば旧い処理に戻せる。
だから安心して新しいものを試せる。

これが「ゼロから書き直す」との決定的な違いです。

書き直しは、お店を閉めて改装する。
ストラングラー・フィグは、営業しながら改装する。



もし今、
「直したいけど、触ると壊れそう」
って感じているものがあるなら。

壊さなくていいんです。

隣に、新しいものを置けばいい。
古いものは、役目が終わるまで残しておく。

そして、新しいほうが安定したら、
古いほうを、静かに片付ける。



変えることと、壊すことは、ちがいます。

覆い被さって、やがて取って代わる。

自然は何億年も前から、
それをやっていたんですよね。

