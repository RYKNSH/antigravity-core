# 🎥 Videdit 2.0: ユーザーガイド (非エンジニア向け)

エンジニアでなくても大丈夫。このシステムは、**「SSDを挿すだけで、どこでも同じように動く自分専用の編集アシスタント」** です。

## 🌟 コンセプト: 「ポータブルなキッチンカー」
以前は、パソコンごとに複雑な設定が必要で、よく「エラーで動かない」ことがありました。
Videdit 2.0では、**「工場（プログラム）」と「道具（PythonやFFmpeg）」を全てSSDの中にカプセル化**しました。

- **従来のシステム**: 現地で包丁や鍋を調達する「出張シェフ」。キッチンが違えば料理の味（動作）が変わってしまう。
- **Videdit 2.0**: 全てが揃った「キッチンカー」。どこの駐車場（Mac）に停めても、電源を繋ぐだけで最高品質の料理が出せる。

---

## 🚀 使い方 (3ステップ)

### Step 1: システムの起動
ターミナルで以下のコマンドを打つだけです。これが「発電機のスイッチを入れる」合図です。

```bash
make dev
```

自動的に以下の準備が行われます：
- AIエンジンやメディアツールが起動します。
- 司令室（ダッシュボード）がブラウザで立ち上がります。
- 画面右上のヘッダーに **「Open Studio」** ボタンが表示されたら準備完了です。ここからいつでもマニュアル編集画面へ移動できます。

### Step 2: 動画素材の投入
最も確実な方法は、ダッシュボード経由での投入です：
- **Dashboard (推奨・確実)**: ブラウザ上のダッシュボード左上にある **「Drop Video Here」** エリアに動画ファイルを直接ドラッグ＆ドロップします。この方法は、アップロード完了と同時にシステムが即座に解析を開始するため、非常に安定しています。
- **Folder (手動/フォールバック)**: FinderでSSDの中にある **`backend/input`** フォルダを開き、ファイルをドラッグ＆ドロップします。この場合、システムがファイルを検知するまで数秒〜数十秒かかる場合があります。

システムがファイルを認識すると、自動的に解析と「ドラフト（16:9）」の作成が始まります。

### Step 3: 進捗の確認
ダッシュボード（`http://localhost:3000`）を開くと、現在の状況がリアルタイムで表示されます。
- **PENDING**: 順番待ち。
- **PROCESSING**: AIが分析中（音声文字起こしや音源分離を実行中）。
- **COMPLETED**: 解析完了。

完了すると、編集指示書（Blueprint）に基づき、プレビュー用の動画（ドラフト）が生成されます。

### 3. Review & Telop Editing (成果物の確認と調整)

解析完了後、ダッシュボードのプロジェクトリストから「レビュー」を開きます。

- **Archive Review**: ジェットカット済みの 16:9 動画を確認。
- **Shorts Review (✨ 3つのタイプ)**: AI が以下の 3 種類の切り口でショート動画を抽出します。
    - **COMPLETE (完結型)**: 「始まり→中盤→オチ」が 1 分以内に収まっている、単体で面白いクリップです。YouTube ショート等のプラットフォームで評価されやすいよう、**30〜60秒**の尺を厳格に維持します。
    - **TEASER (予告編型)**: 「続きが気になる！」ところで終わる、本編フル動画への誘導に適したクリップです。対談の盛り上がり部分などが選ばれます。
    - **QUOTE (引用型)**: 5〜15秒程度の、ハッとする「名言」や「核心を突いた一言」の切り抜きです。SNSでのシェアや引用に適しています。
- **Telop Optimization (Semantic Split v2)**:
    - **Automatic**: テロップセクションを展開すると、最新の「セマンティック分割ロジック（v2）」が自動適用されます。
    - **Badge**: 適用された行には「v2」バッジが表示されます。
    - **Manual Resplit**: 「✨ v2で再分割」ボタンを押すと、いつでも意味的な改行を再実行できます。
    - **Undo**: 分割が気に入らない場合は「↩️ 元に戻す」で Whisper 直出しのセグメントへ戻せます。
- **Template Selection**: プルダウンメニューから好きなデザイン（例: 「Videditショート用デザインテンプレ」）を選択します。
    - **🎨 プレビュー確認**: テンプレートを選択すると、自動的に「テンプレートを適用した状態の静止画」が生成されます。これにより、本番の書き出し（数分かかります）を待つ前に、ロゴの位置や動画の収まりを確認できます。
    - **承認**: デザインに納得がいったら **「🎨 Approve with Template」** ボタンを押します。
    - **重要**: アスペクト比が異なる動画でも、AIが自動的に黒帯を追加して綺麗に配置します。

### 4. Non-Blocking Production (即時承認とバックグラウンド書き出し)
Videdit 3.0 では、承認ボタン（Approve）を押した瞬間にシステムが応答し、**待ち時間なしで次の作業へ移ることができます。**

- **即時レスポンス**: ボタンを押すとすぐに「完了（Approved ✓）」が表示されます。
- **プレビューの維持 (Draft Continuity)**: 承認後も、プレビュー動画は消えたり切り替わったりすることなく再生され続けます。これにより、書き出し中もテロップやタイミングを最終確認することが可能です。
- **Rendering Queue**: 画面右下に **「Rendering Queue」** というフローティングパネルが表示されます。ここには現在バックグラウンドでレンダリング（動画合成）が行われているタスクの進捗がリアルタイムで表示されます。
- **並行作業**: 一つの動画の書き出しを待つ必要はありません。次々と動画をチェックし、承認していくことができます。
- **通知**: 書き出しが完了すると、パネル内の進捗が 100% になり、緑のチェックマークが表示されます。

承認されたショート動画は、バックエンドの「Render Queue」で安全にキューイングされ、高品質な最終レンダリングが実行されます。

### Step 5: デザインの微調整 (Template Studio)
承認された動画に対して、レイアウトや文字の位置をカスタマイズしたい場合は **Template Studio** を活用します。

1.  **直感的な操作**: 画面上の文字やロゴを直接クリックして、好きな場所にドラッグ＆ドロップで移動できます。
2.  **要素の選択**: 左側のレイヤー一覧から調整したい項目（動画、画像、テキスト）を選択します。選択された要素には枠が表示されます。
3.  **重ね順の変更**: レイヤーを上下に入れ替えることで、文字を動画の前面に持ってくるなどの調整が可能です。
4.  **プロパティ調整**: 右側のパネルから、フォントの大きさや色の変更、透明度の調整がリアルタイムに行えます。
5.  **動画・画像のアップロード**: 動画レイヤーや画像レイヤーを選択した状態で、右側のプロパティパネルにある「アップロード」ボタンを押すと、自分のPCから好きなファイルを素材として追加できます。
6.  **PSDインポート (New)**: Telop Designerのキャンバスに直接 **`.psd` ファイルをドラッグ＆ドロップ** するか、ツールボタンからインポートすることで、新しいデザインテンプレートを即座に取り込み、現在編集中の動画に適用することができます。

---

## 🎥 超長尺素材（Long-Form Stream）の処理について

V2では、3〜5時間のライブ配信アーカイブなどの「超長尺（Long-Form）」素材にも対応しています。

- **自動分割システム**: 音声データが極めて大きい場合、システムが自動的に10分単位のチャンクに分割して文字起こしを行います。これにより、APIのタイムアウトやメモリ不足を防ぎ、長時間の素材も確実に出力まで完遂させます。
- **ウィンドウ分析**: AIによるハイライト抽出も、数時間分のデータを一気に読み込むのではなく、45〜60分ごとの「分析窓」をスライドさせながら実行します。これにより、「動画の後半でAIが疲れて精度が落ちる」といった現象を回避し、全編にわたって高いクオリティのショート動画候補を抽出します。
- **所要時間の目安**: 長尺素材の処理（特に音声分離 Demucs）は非常に重い作業です。高品質な処理には素材時間の1/2〜等倍程度の時間がかかる場合がありますが、ブラウザを閉じてもバックエンドで処理は継続され、SSE（リアルタイム通信）によって進捗は常に最新の状態に保たれます。

---

## ✅ 困ったときは

もし「動かないな？」と思ったら、工場のリセットが必要です。
```bash
make clean    # 工場の掃除（ゴミの削除）
make setup    # 道具の再配置（再構築）
```

### 画面が開かない・データベースのエラーが出る
**現象**: ダッシュボードを開こうとすると「Failed to open database」や「invalid digit found in string」といったエラーが出る。
**解決策**: ダッシュボードのキャッシュファイルを削除します。
```bash
cd apps/dashboard
rm -rf .next
pnpm dev
```

### アーカイブ動画が極端に短いとき（2〜3秒など）
AIが音声の文字起こしに失敗した可能性があります。
1.  **AIキーの確認**: システムが OpenAI の API キーを正しく認識していない可能性があります。SSDの中にある **`.antigravity/.env`** ファイル、またはパソコン内の秘密設定ファイルに正しいキー（`sk-...`）が記述されているか確認してください。設定を変更した後は、バックエンド（`make dev`）を再起動する必要があります。
2.  **再インジェスト**: 同じ動画ファイルをもう一度ダッシュボードにドロップ、または `backend/input` フォルダに入れ直してください。
3.  **マニュアル再実行**: 自動で始まらない場合は、ターミナルからマニュアル実行コマンド（`curl -X POST ...`）を打つことで強制的に再処理できます。
4.  **確認**: それでも直らない場合は、マニュアル編集（Studio）画面でテロップが正しく表示されているか確認してください。テロップが全くない場合は、文字起こしステップでエラーが発生しています。

---

## 🛠️ 運用テクニック: 「 detached 起動」で編集を止めるな
複数の動画を処理する場合、AIアシスタントのセッションが切れてもオーケストレーターを動かし続けることができます。
```bash
# バックエンドを裏側で常駐させる
cd backend
nohup ../.bin/uv run uvicorn api:app --reload --port 8000 > /tmp/videdit_backend.log 2>&1 & disown
```
これにより、ブラウザのダッシュボードをリロードしたり、エージェントが休憩（Checkout）している間も、動画の解析やショート作成が自動で継続されます。
