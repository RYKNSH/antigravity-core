# Claude Code Agent Teams: Deep Analysis & Reference

## 1. 概要 (Overview)
Agent Teams は、複数のエージェント（Claude Code インスタンス）をチームとして並列実行・調整する機能です。1人の「リーダー」が複数の「メンバー」を指揮し、共有タスクリストを通じて大規模かつ複雑なタスクを迅速に完了させます。

## 2. コア・アーキテクチャ (Architecture)
- **並列実行**: `tmux` セッション等を活用した物理的な並列プロセス実行。
- **リーダー・メンバー構造**: メインエージェントがチームを作成し、サブエージェントにタスクを割り当てる。
- **設定ファイル**: `~/.claude/teams/{team-name}/config.json` にチーム構成を保持。
- **共有タスクリスト**: `~/.claude/tasks/{team-name}/` ですべてのエージェントがタスクステータスを共有。

## 3. コンテキストと通信 (Communication)
- **自動メッセージ配信 (Auto-delivery)**: メンバーがメッセージを送信すると、受信者に自動的にプッシュされる。
- **アイドル通知**: メンバーがタスクを完了して停止すると、自動的にリーダーに通知。
- **メッセージング・コマンド**:
    - `message`: 特定のメンバーに 1対1 で送信。
    - `broadcast`: チーム全員に同時送信（コスト高のため控えめに使用）。

## 4. 主なユースケース (Use Cases)
### 4.1 並列コードレビュー
- **PR レビュー**: Security / Performance / Test Coverage の 3視点を持つレビュー担当者を同時に生成し、それぞれの知見をマージする。

### 4.2 競合する仮説でのデバッグ (Scientific Debate)
- **バグ調査**: 5人のメンバーを生成し、それぞれ異なる仮説を検証させる。
- **合意形成**: お互いの理論に反論し合い（Disprove）、最終的にコンセンサスを形成してドキュメントを更新する。

### 4.3 調査とレビュー
- 複数のメンバーが問題の異なる側面を同時に調査し、発見を共有。

### 4.4 クロスレイヤー調整
- Frontend, Backend, Test にまたがる変更を各担当メンバーが並列で実施。

## 5. ベストプラクティス (Best Practices)
- **十分なコンテキストの提供**: メンバー生成時に、役割、対象ファイル、具体的な調査項目を明確に指示する。
- **タスクサイズの設定**:
    - 小さすぎる: 調整コストが利益を上回る。
    - 大きすぎる: メンバーが長時間チェックインなしで動作し、無駄な努力のリスクが増える。
    - **適切**: 関数、テストファイル、レビュー等、明確な成果物を生成する自己完結型ユニット。
- **調査とレビューから始める**: 実装に進む前に、エージェントチームの並列性を活かして多角的な調査を行う。
- **ファイルの競合回避**: 同一ファイルへの同時書き込みが発生しないよう、リーダーがタスク分割を行う。

## 6.Antigravity への応用 (Thinking Model)
Antigravity 環境では、物理的な並列実行の代わりに「思考モデル」としてこれを採用：
- **リーダー**: メインエージェント (HR Director)。
- **メンバー**: 順次召集される専門家ペルソナ。
- **共有タスク**: `task.md` および `DEBATE_FINDINGS.md`。
- **通信**: `/debate` ワークフローを通じた逐次的コンテキストの引き継ぎ。

#### 再現されるコア・プロセス
1. **Round 0**: 各ペルソナによる独立した初期レビュー。
2. **Round 1-N (相互反論)**: **最重要フェーズ**。他ペルソナの見解に対する反論、譲歩、補強を通じた科学的議論。
3. **Phase 4 (合意形成)**: リーダーによる議論の要約と最終推奨案の策定。

#### 議論の 4大基準
- **批判的分析**: 賛成だけでなく、必ず弱点を見つける。
- **エビデンスベース**: 主張には常に具体的根拠を示す。
- **誠実な譲歩**: 妥当な反論に対しては柔軟に自己見解を修正する。
- **統合志向**: 最終的に「合意点」と「残留懸念」を明確にする。

詳細な実装プロトコル（フェーズ構成、報酬モデル）については、[`agent_architecture.md`](agent_architecture.md) を参照。
