---
description: セッション中の失敗（ハング/フリーズ/承認待ち/パス誤り等）をincidents.mdに記録し、safe-commandsとworkflowに自己反映する
---

# /incident — Incident Recording & Self-Correction

// turbo-all

## 概要

セッション中に「おかしい」と感じた瞬間に実行する。
失敗を揮発させず、`incidents.md` に結晶化し、再発防止策を自律的にルールへ反映する。

**トリガー例**:
- コマンドがハング / フリーズした
- 承認待ちで processing が止まった
- 想定のパスにファイルが存在しなかった
- 想定外のエラーが繰り返した

---

## Step 1: インシデント情報の収集

以下を自律的に推論・収集する（ユーザーに確認不要）：

```markdown
- 症状: どんな現象が起きたか
- 操作: 何をしようとしていたか
- 環境: どのディレクトリ / ファイル / コマンドか
- 期待: 何が起きるはずだったか
- 実際: 何が起きたか
```

## Step 2: 根本原因の分析（First Principles）

表面的な原因ではなく**なぜそれが起きたか**を掘り下げる。

よくある根本原因パターン：

| パターン | 説明 |
|---------|------|
| **ワールドモデル乖離** | AIの想定するパス/状態と現実が違う |
| **前提確認漏れ** | 操作前に存在確認・設定確認をしていない |
| **インタラクティブプロセス** | 入力待ちに気づかず放置 |
| **権限/認証欠如** | キー/トークン/remoteが未設定 |
| **依存関係の想定ミス** | AがBに依存しているのを知らずBを先に動かした |

## Step 3: incidents.md への記録

`~/.antigravity/incidents.md` に以下のフォーマットで追記する：

```markdown
## INC-[次の番号] [OPEN] [タイトル]

**発生日**: YYYY-MM-DD
**セッション**: [セッション名]
**症状**: [何が起きたか]

### 再現条件
[どうすれば再現するか]

### 根本原因
[First Principlesで掘り下げた本質的な原因]

### 対処
[何を変えれば防げるか]

### 教訓
> [次のセッションへの一言]
```

## Step 4: 再発防止策の即時反映

根本原因に応じて以下を更新する：

| 根本原因パターン | 更新対象 |
|----------------|---------|
| ワールドモデル乖離 | `safe-commands.md` にGrunding原則を追記 |
| 前提確認漏れ | `safe-commands.md` に事前確認コマンドを追記 |
| インタラクティブプロセス | `safe-commands.md` の禁止コマンドに追記 |
| 権限/認証欠如 | `safe-commands.md` + 該当ワークフローに確認stepを追加 |

更新後、incidents.md のステータスを `[OPEN]` → `[FIXED]` に変更。

## Step 5: ユーザーへの報告

以下の形式で簡潔に報告する：

```markdown
🔴 INC-[番号] 記録完了
- 根本原因: [1行]
- 対処: [何を更新したか]
- 再発確率: [低/中/高]
```

## 完了条件

- `incidents.md` に新規エントリが追記されている
- 対処が `safe-commands.md` か該当ワークフローに反映されている
- ステータスが `[FIXED]` になっている
